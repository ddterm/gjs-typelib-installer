# SPDX-FileCopyrightText: 2025 Aleksandr Mezin <mezin.alexander@gmail.com>
#
# SPDX-License-Identifier: MIT

x-service-base: &x-service-base
  tty: true

  cap_add:
    - SYS_ADMIN
    - SYS_NICE
    - SYS_PTRACE
    - SETPCAP
    - NET_RAW
    - NET_BIND_SERVICE
    - IPC_LOCK

  volumes:
    - type: bind
      source: .
      target: /opt/

  working_dir: /opt/tests

  healthcheck:
    interval: 10s
    start_period: 2m
    test:
      - CMD
      - systemctl
      - is-system-running

services:
  fedora-43:
    <<: *x-service-base
    build:
      context: tests
      dockerfile: fedora-43.dockerfile
      target: base

  fedora-43-packagekit:
    <<: *x-service-base
    build:
      context: tests
      dockerfile: fedora-43.dockerfile
      target: packagekit
